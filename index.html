<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Flashcards</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <!-- KaTeX pour LaTeX -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"
    onload="renderMathInElement(document.body);"></script>

  <style>
    :root {
      --orange-1: #ff9f1c;
      --orange-2: #ff6b35;
      --bg-a: #a8edea;
      --bg-b: #fed6e3;
      --card-shadow: 0 8px 20px rgba(16,24,40,0.12);
    }

    html, body {
      height: 100%;
      margin: 0;
      font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      color: #222;
      background: linear-gradient(90deg, var(--bg-a), var(--bg-b));
      -webkit-font-smoothing: antialiased;
    }

    main { flex: 1; }

    .hero {
      background: linear-gradient(90deg, var(--orange-1), var(--orange-2));
      color: white;
      padding: 28px 20px 56px 20px;
      position: relative;
      overflow: visible;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
    }

    .hero-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .hero-left {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .hero-left .small { font-size: 14px; opacity: 0.95; letter-spacing: 0.6px; }
    .hero-left h1 { margin: 0; font-size: 34px; line-height: 1; font-weight: 700; }

    .hero .create-btn {
      background: rgba(255,255,255,0.98);
      color: var(--orange-2);
      border: none;
      padding: 10px 16px;
      border-radius: 999px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(0,0,0,0.12);
      transition: transform .14s ease;
      margin-left: 6px;
    }
    .hero .create-btn:hover { transform: translateY(-3px); }

    .hero-art {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: -28px;
      display: flex;
      gap: -28px;
      pointer-events: none;
    }

    .mini-card {
      width: 120px; height: 72px; border-radius: 12px;
      box-shadow: var(--card-shadow);
      display: flex; flex-direction: column; justify-content: center; align-items: center;
      font-weight: 600; color: #333;
    }

    .container { max-width: 1200px; margin: 60px auto 40px; padding: 0 18px; }

    .levels { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px,1fr)); gap: 18px; }

    .level-card {
      background: white;
      border-radius: 16px;
      padding: 20px;
      display: flex;
      gap: 12px;
      align-items: center;
      box-shadow: var(--card-shadow);
      cursor: pointer;
      transition: transform .16s ease, box-shadow .16s ease;
    }
    .level-card:hover { transform: translateY(-6px); }

    .icon-square {
      width: 72px; height: 72px; border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      color: white; font-size: 28px;
    }

    #createSection { display: none; max-width: 980px; margin: 26px auto; padding: 18px; }

    textarea {
      width: 100%;
      min-height: 90px;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #e6e6e9;
      resize: vertical;
      font-size: 14px;
    }

    .flashcard {
      width: 220px;
      height: 140px;
      perspective: 1000px;
      cursor: pointer;
    }

    .flashcard-inner {
      width: 100%;
      height: 100%;
      position: relative;
      transition: transform .6s;
      transform-style: preserve-3d;
    }

    .flashcard.flipped .flashcard-inner {
      transform: rotateY(180deg);
    }

    .front, .back {
      position: absolute;
      inset: 0;
      border-radius: 12px;
      backface-visibility: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 12px;
      font-weight: 600;
      box-shadow: 0 6px 14px rgba(0,0,0,0.08);
      overflow-wrap: break-word;
    }

    .front { background: #fff7ef; }
    .back { background: #e6f0ff; transform: rotateY(180deg); }

    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      align-items: center;
      justify-content: center;
      z-index: 60;
    }

  </style>
</head>

<body>
  <header class="hero" role="banner">
    <div class="hero-inner">
      <div class="hero-left">
        <div class="small">Les cartes</div>
        <h1>Flashcards</h1>
      </div>
      <div>
        <button class="create-btn" onclick="showLevels()">üìö √âtudier</button>
        <button class="create-btn" onclick="toggleCreate()">‚úèÔ∏è Cr√©er</button>
      </div>
    </div>
  </header>

  <main class="container">
    <section id="levelsSection">
      <div class="levels" id="levelsGrid"></div>
    </section>

    <section id="createSection">
      <h2>Cr√©er / R√©viser les cartes</h2>
      <label class="muted">Recto</label>
      <textarea id="frontText" placeholder="Texte recto (LaTeX possible avec $...$)"></textarea>
      <input id="frontImg" type="file" accept="image/*">
      <label class="muted">Verso</label>
      <textarea id="backText" placeholder="Texte verso (LaTeX possible avec $...$)"></textarea>
      <input id="backImg" type="file" accept="image/*">

      <div class="controls">
        <button class="btn btn-add" id="addCardBtn">Ajouter la carte</button>
        <button class="btn btn-secondary" id="exportBtn">Exporter JSON</button>
        <button class="btn btn-secondary" id="importBtn">Importer JSON</button>
        <button class="btn btn-add" id="reviseBtn">R√©viser</button>
      </div>

      <div id="cardsList"></div>
    </section>
  </main>

  <div class="modal" id="chapterModal">
    <div class="card">
      <div class="close" onclick="closeModal()">‚úï</div>
      <h2 id="modalTitle">Chapitres</h2>
      <ul class="chapter-list" id="chapterList"></ul>
      <button class="start-btn" onclick="startRevision()">‚ñ∂Ô∏è Commencer</button>
    </div>
  </div>

  <script>
    // --- Donn√©es des niveaux et chapitres ---
    const chapters = {
      "Seconde": ["Chapitre 1 : Bases"]
    };
    const chapterDecks = {
      "Seconde Chapitre 1 : Bases": [
        { front: "f(x)=x^2", back: "\\text{d√©riv√©e } 2x" },
        { front: "(a+b)^2", back: "a^2 + 2ab + b^2" },
        { front: "\\sin^2\\theta + \\cos^2\\theta", back: "1" }
      ]
    };

    let deck = [];

    function renderMath(container) {
      renderMathInElement(container, {
        delimiters: [
          { left: "$$", right: "$$", display: true },
          { left: "$", right: "$", display: false }
        ]
      });
    }

    // --- Ajout de carte ---
    async function addCard() {
      const fTxt = document.getElementById('frontText').value.trim();
      const bTxt = document.getElementById('backText').value.trim();
      if (!fTxt && !bTxt) return alert("Ajoute du texte ou une image.");
      deck.push({ front: fTxt, back: bTxt });
      renderCardsPreview();
    }

    function renderCardsPreview() {
      const list = document.getElementById('cardsList');
      list.innerHTML = '';
      deck.forEach(c => {
        const div = document.createElement('div');
        div.className = 'flashcard';
        div.innerHTML = `
          <div class="flashcard-inner">
            <div class="front">${c.front}</div>
            <div class="back">${c.back}</div>
          </div>`;
        div.addEventListener('click', () => div.classList.toggle('flipped'));
        list.appendChild(div);
        renderMath(div);
      });
    }

    document.getElementById('addCardBtn').addEventListener('click', addCard);

    // --- Mode r√©vision avec cartes retournables ---
    document.getElementById('reviseBtn').addEventListener('click', () => {
      if (deck.length === 0) return alert("Aucune carte √† r√©viser !");
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.style.display = 'flex';
      const cardDiv = document.createElement('div');
      cardDiv.className = 'flashcard';
      cardDiv.innerHTML = `
        <div class="flashcard-inner">
          <div class="front"></div>
          <div class="back"></div>
        </div>`;
      const inner = cardDiv.querySelector('.flashcard-inner');
      modal.appendChild(cardDiv);
      document.body.appendChild(modal);
      let i = 0;
      showCard();

      function showCard() {
        const c = deck[i];
        cardDiv.querySelector('.front').innerHTML = c.front;
        cardDiv.querySelector('.back').innerHTML = c.back;
        renderMath(cardDiv);
        inner.classList.remove('flipped');
      }

      cardDiv.addEventListener('click', () => inner.classList.toggle('flipped'));
      modal.addEventListener('click', e => {
        if (e.target === modal) document.body.removeChild(modal);
      });
    });
  </script>
</body>
</html>
