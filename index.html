<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>Flashcards</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root{
 /* Couleurs et ombres utilis√©es dans tout le site */
 --orange-1: #ff9f1c;
 --orange-2: #ff6b35;
 --bg-a: #a8edea;
 --bg-b: #fed6e3;
 --card-shadow: 0 8px 20px rgba(16,24,40,0.12);
}
/* Styles g√©n√©raux pour body, headers, boutons, cartes, etc. */
html,body{ height:100%; margin:0; font-family:"Segoe UI", Roboto, Arial, sans-serif; color:#222; background: linear-gradient(90deg,var(--bg-a),var(--bg-b)); }
/* ... Tout ton CSS existant reste inchang√© ... */
</style>
</head>
<body>

<!-- Ent√™te avec le titre et les boutons √âtudier / Cr√©er -->
<header class="hero" role="banner">
 <div class="hero-inner">
  <div class="hero-left">
   <div class="small">Les cartes</div>
   <h1>Flashcards</h1>
  </div>
  <div>
   <button class="create-btn" onclick="showLevels()">üìö √âtudier</button> <!-- Affiche la s√©lection du niveau -->
   <button class="create-btn" onclick="toggleCreate()">‚úèÔ∏è Cr√©er</button>  <!-- Affiche le formulaire de cr√©ation de carte -->
  </div>
 </div>
 <!-- Mini-cartes d√©coratives en ent√™te -->
 <div class="hero-art" aria-hidden="true">
  <div class="mini-card"><div class="q">f(x)=x¬≤</div><div class="a">‚Üí d√©riv√©e 2x</div></div>
  <div class="mini-card"><div class="q">(a+b)¬≤</div><div class="a">= a¬≤ + 2ab + b¬≤</div></div>
  <div class="mini-card"><div class="q">sin¬≤+cos¬≤</div><div class="a">=1</div></div>
 </div>
</header>

<main class="container" role="main">
 <!-- Section de s√©lection des niveaux -->
 <section id="levelsSection">
  <div class="levels" id="levelsGrid">
   <!-- Chaque niveau ouvre la modal pour choisir un chapitre -->
   <article class="level-card" onclick="openModal('Seconde')">
    <div class="icon-square icon-blue">S</div>
    <div class="level-body"><h3>Seconde</h3><p class="muted">Bases / Fonctions / G√©om√©trie</p></div>
   </article>
   <article class="level-card" onclick="openModal('Premi√®re')">
    <div class="icon-square icon-teal">1</div>
    <div class="level-body"><h3>Premi√®re</h3><p class="muted">Suites / Probabilit√©s / Analyse</p></div>
   </article>
   <article class="level-card" onclick="openModal('Terminale')">
    <div class="icon-square icon-green">T</div>
    <div class="level-body"><h3>Terminale</h3><p class="muted">D√©riv√©es / Int√©grales / Logarithmes</p></div>
   </article>
   <article class="level-card" onclick="openModal('Maths expertes')">
    <div class="icon-square icon-amber">M</div>
    <div class="level-body"><h3>Maths expertes</h3><p class="muted">Complexes / Graphes / Matrices</p></div>
   </article>
  </div>
 </section>

 <!-- Section cr√©ation de carte -->
 <section id="createSection" aria-hidden="true">
  <h2>Cr√©er une nouvelle carte</h2>
  <label class="muted">Recto</label>
  <textarea id="frontText" placeholder="Texte recto (LaTeX possible brut)"></textarea>
  <input id="frontImg" type="file" accept="image/*">
  <label class="muted">Verso</label>
  <textarea id="backText" placeholder="Texte verso"></textarea>
  <input id="backImg" type="file" accept="image/*">
  <div class="controls">
   <button class="btn btn-add" id="addCardBtn">Ajouter la carte</button> <!-- Ajoute la carte au deck -->
   <button class="btn btn-secondary" onclick="exportDeck()">Exporter</button> <!-- T√©l√©charge le deck en JSON -->
   <button class="btn btn-secondary" id="importBtn">Importer</button> <!-- Ouvre le fichier JSON existant -->
   <button class="btn btn-add" id="reviseBtn">R√©viser</button> <!-- Lance la r√©vision du deck actuel -->
  </div>
  <div id="cardsList" aria-live="polite"></div> <!-- Aper√ßu des cartes cr√©√©es -->
  <input type="file" id="importFile" accept=".json" style="display:none">
 </section>
</main>

<!-- Modal de s√©lection de chapitre -->
<div class="modal" id="chapterModal" role="dialog" aria-modal="true" aria-hidden="true">
 <div class="card">
  <div class="close" onclick="closeModal()">‚úï</div>
  <h2 id="modalTitle">Chapitres</h2>
  <ul class="chapter-list" id="chapterList"></ul> <!-- Liste des chapitres selon le niveau -->
  <button class="start-btn" onclick="startRevision()">‚ñ∂Ô∏è Commencer</button>
 </div>
</div>

<script>
// üîπ Variables globales
const chapters = {
 "Seconde":["Chapitre 1 : Bases","Chapitre 2 : Fonctions","Chapitre 3 : G√©om√©trie"],
 "Premi√®re":["Chapitre 1 : Suites","Chapitre 2 : Probabilit√©s","Chapitre 3 : Analyse"],
 "Terminale":["Chapitre 1 : D√©riv√©es","Chapitre 2 : Int√©grales","Chapitre 3 : Logarithmes"],
 "Maths expertes":["Chapitre 1 : Nombres complexes","Chapitre 2 : Graphes","Chapitre 3 : Matrices"]
};
let currentLevel = null; // Niveau s√©lectionn√©
let selectedChapter = null; // Chapitre s√©lectionn√©
let deck = []; // Contient les cartes √† r√©viser

// üîπ Ouvre la modal de s√©lection de chapitre pour un niveau
function openModal(level){
 currentLevel = level;
 selectedChapter = null;
 document.getElementById('modalTitle').textContent = level + " ‚Äî Chapitres";
 const list = document.getElementById('chapterList');
 list.innerHTML = '';
 (chapters[level] || []).forEach(chap => {
  const li = document.createElement('li');
  li.textContent = chap;
  li.onclick = () => {
   Array.from(list.children).forEach(c => c.style.background = '');
   li.style.background = '#dfefff';
   selectedChapter = chap;
  };
  list.appendChild(li);
 });
 const modal = document.getElementById('chapterModal');
 modal.style.display = 'flex';
 modal.setAttribute('aria-hidden','false');
}

// üîπ Ferme la modal
function closeModal(){
 const modal = document.getElementById('chapterModal');
 modal.style.display = 'none';
 modal.setAttribute('aria-hidden','true');
 selectedChapter = null;
}

// üîπ Affiche la section cr√©ation de carte
function toggleCreate(){
 const create = document.getElementById('createSection');
 const levels = document.getElementById('levelsSection');
 if(create.style.display==='block'){
  create.style.display='none';
  levels.style.display='';
  create.setAttribute('aria-hidden','true');
 } else {
  create.style.display='block';
  levels.style.display='none';
  create.setAttribute('aria-hidden','false');
 }
}

// üîπ Affiche la s√©lection des niveaux
function showLevels(){
 document.getElementById('createSection').style.display='none';
 document.getElementById('createSection').setAttribute('aria-hidden','true');
 document.getElementById('levelsSection').style.display='block';
}

// üîπ √âchappe le texte pour l'affichage HTML
function escapeHtml(s){
 return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('\n','<br>');
}

// üîπ Ajoute une carte au deck
async function addCard(){
 const fTxt = document.getElementById('frontText').value.trim();
 const bTxt = document.getElementById('backText').value.trim();
 const fFile = document.getElementById('frontImg').files[0];
 const bFile = document.getElementById('backImg').files[0];
 let fImg="", bImg="";
 if(fFile) fImg = await new Promise(r=>{const fr=new FileReader(); fr.onload=e=>r(e.target.result); fr.readAsDataURL(fFile);});
 if(bFile) bImg = await new Promise(r=>{const fr=new FileReader(); fr.onload=e=>r(e.target.result); fr.readAsDataURL(bFile);});
 if(!fTxt && !bTxt && !fImg && !bImg){ alert("Ajoute du texte ou une image."); return; }
 deck.push({front:fTxt, back:bTxt, frontImg:fImg, backImg:bImg});
 renderCardsPreview();
 document.getElementById('frontText').value='';
 document.getElementById('backText').value='';
 document.getElementById('frontImg').value='';
 document.getElementById('backImg').value='';
}

// üîπ Affiche les cartes cr√©√©es dans le DOM
function renderCardsPreview(){
 const list = document.getElementById('cardsList');
 list.innerHTML='';
 deck.forEach(c=>{
  const div=document.createElement('div');
  div.className='flashcard';
  div.innerHTML=`<div class="flashcard-inner">
   <div class="front">${c.frontImg?`<img src="${c.frontImg}" style="max-width:90%;max-height:100px"><br>`:''}${escapeHtml(c.front||'')}</div>
   <div class="back">${c.backImg?`<img src="${c.backImg}" style="max-width:90%;max-height:100px"><br>`:''}${escapeHtml(c.back||'')}</div>
  </div>`;
  div.addEventListener('click',()=>div.classList.toggle('flipped')); // Retourne la carte
  list.appendChild(div);
 });
}

// üîπ Export du deck au format JSON
function exportDeck(){
 if(deck.length===0){ alert("Aucune carte"); return; }
 const blob = new Blob([JSON.stringify(deck)],{type:"application/json"});
 const a=document.createElement('a');
 a.href=URL.createObjectURL(blob);
 a.download="deck.json";
 a.click();
}

// üîπ Import du deck depuis fichier JSON
document.getElementById('importBtn').addEventListener('click',()=>{ document.getElementById('importFile').click(); });
document.getElementById('importFile').addEventListener('change',evt=>{
 const f=evt.target.files[0]; if(!f) return;
 const fr=new FileReader();
 fr.onload=e=>{
   try{ deck=JSON.parse(e.target.result); renderCardsPreview(); }catch{ alert("Fichier invalide"); }
 };
 fr.readAsText(f);
});
document.getElementById('addCardBtn').addEventListener('click',addCard);

// üîπ Fonction de m√©lange d'un tableau
function shuffle(array){
 for(let i=array.length-1;i>0;i--){
   const j=Math.floor(Math.random()*(i+1));
   [array[i],array[j]]=[array[j],array[i]];
 }
 return array;
}

// üîπ Lancer la r√©vision d'un chapitre s√©lectionn√© (popup avec cartes JSON)
async function startRevision(){
 if(!selectedChapter){ alert("S√©lectionne un chapitre"); return; }

 // üîπ G√©n√®re le chemin du fichier JSON selon niveau et chapitre
 const level = currentLevel.toLowerCase().replace("√®","e").replace("√©","e").replace(/\s+/g,"");
 const chapNum = selectedChapter.split(":")[0].trim().toLowerCase().replace(/\s+/g,"");
 const stockPath = `./niveaux/${level}_${chapNum}.json`;

 try {
   const res = await fetch(stockPath);
   if(!res.ok) throw new Error("Fichier introuvable");
   deck = await res.json(); // Charge les cartes

   if(deck.length === 0){ alert("Aucune carte disponible pour ce chapitre !"); return; }

   let idx = 0, correct = 0, incorrect = 0;
   const shuffled = [...deck];
   shuffle(shuffled);

   // üîπ Cr√©ation de la modal de r√©vision
   const modal = document.createElement('div');
   modal.className = 'modal';
   modal.style.display = 'flex';
   modal.innerHTML = `
     <div class="card" style="max-width:500px;text-align:center;position:relative;">
       <div class="close" id="closeRevise">‚úï</div>
       <div id="reviseContent"></div>
       <div id="reviewInfo" style="margin-top:10px;">Carte 1/${shuffled.length} | ‚úîÔ∏è 0 | ‚ùå 0</div>
       <div id="reviewButtons" style="margin-top:12px;">
         <button id="correctBtn" class="btn btn-add">Correcte</button>
         <button id="incorrectBtn" class="btn btn-secondary">Incorrecte</button>
       </div>
     </div>
   `;
   document.body.appendChild(modal);

   const container = modal.querySelector('#reviseContent');
   const infoDiv = modal.querySelector('#reviewInfo');

   function updateInfo(){ 
     infoDiv.textContent = `Carte ${idx+1}/${shuffled.length} | ‚úîÔ∏è ${correct} | ‚ùå ${incorrect}`;
   }

   function showCard(i){
     const c = shuffled[i];
     container.innerHTML = `
       <div class="flashcard" style="width:300px;height:180px;margin:auto;">
         <div class="flashcard-inner">
           <div class="front">${c.frontImg ? `<img src="${c.frontImg}" style="max-width:90%;max-height:100px"><br>` : ''}${escapeHtml(c.front || '')}</div>
           <div class="back">${c.backImg ? `<img src="${c.backImg}" style="max-width:90%;max-height:100px"><br>` : ''}${escapeHtml(c.back || '')}</div>
         </div>
       </div>
     `;
     const flash = container.querySelector('.flashcard');
     flash.addEventListener('click', ()=> flash.classList.toggle('flipped'));
   }

   showCard(idx);
   updateInfo();

   modal.querySelector('#correctBtn').onclick = () => { correct++; nextCard(); };
   modal.querySelector('#incorrectBtn').onclick = () => { incorrect++; nextCard(); };
   modal.querySelector('#closeRevise').onclick = () => { document.body.removeChild(modal); };

   function nextCard(){
     idx++;
     if(idx >= shuffled.length){ endRevision(); }
     else { showCard(idx); updateInfo(); }
   }

   function endRevision(){
     updateInfo();
     alert("R√©vision termin√©e !");
     document.body.removeChild(modal);
   }

 } catch(e){
   alert("Impossible de charger les cartes : " + e.message);
 }
}
</script>
</body>
</html>


